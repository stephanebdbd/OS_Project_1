#!/bin/bash

#Le script lance img-search avec deux modes possibles: interactif et automatique pour lancer le programme.
PATH="$PATH:./img:./img-dist"
image=$2
database_path=./img

if [ $# -eq 3 ] && [ -d "$3" ]
    then
    database_path=$3
fi

if [ $# -lt 2 ] || [ $# -gt 3 ]
then
    echo $#
    echo "No similar image found (no comparison could be performed successfully)."
elif [ $1 = -h ] || [ $1 = --help ]
then
    #paramètres en fonction du mode aide
    echo "Usage: ./launcher [OPTION]... [IMAGE] [DATABASE_PATH]"
    echo "Lance le programme img-search avec deux modes possibles: interactif et automatique."
    echo "  -h, --help              Affiche l'aide et quitte"
    echo "  -i, --interactive       Mode interactif"
    echo "  -a, --automatic         Mode automatique"
    echo "  IMAGE                   Chemin d'accès de l'image à comparer"
    echo "  DATABASE_PATH           Chemin d'accès du dossier contenant les images à comparer"
    echo "                          (par défaut: ./img/)"
    echo "Exemples:"
    echo "  ./launcher -i image"
    echo "  ./launcher -a image ./img/"
    echo "  ./launcher --help"
elif  [ -f "$image" ] || [ -f "$database_path/$image" ]
then
    if [ -f "$database_path/$image" ]
    then
        image="$database_path/$image"
    fi
    if [ $1 = -i ] || [ $1 = --interactive ]
    then
        #paramètres en fonction du mode interactif
        while true; do
            read -p "Entrez le chemin d'accès d'une image (cliquez sur Enter pour quitter) : " way
            if [ -f "$database_path/$way" ]
            then
                echo "$database_path/$way"
            elif [ -f "$way" ]
            then
                echo "$way"
            elif [ -z "$way" ]
            then
                break
            fi
        done | ./img-search $image
    elif [ $1 = -a ] || [ $1 = --automatic ]
    then
        #paramètres en fonction du mode automatique
        ./list-file $database_path | ./img-search $image
    fi
else
    echo "No similar image found (no comparison could be performed successfully)."
fi